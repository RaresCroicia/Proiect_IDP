_format_version: "2.1"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:3001
    routes:
      - name: auth-service-route
        paths:
          - /auth
        strip_path: true

  - name: course-service
    url: http://course-service:3002
    routes:
      - name: course-service-route
        paths:
          - /courses
        strip_path: true

  - name: ingestion-service
    url: http://ingestion-service:3003
    routes:
      - name: ingestion-service-route
        paths:
          - /ingestion
        strip_path: true

  - name: frontend
    url: http://frontend:80
    routes:
      - name: frontend-route
        paths:
          - /
        preserve_host: true

plugins:
  - name: cors
    config:
      origins: ['*']
      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS']
      headers: ['Accept', 'Accept-Version', 'Content-Length', 'Content-MD5', 'Content-Type', 'Date', 'Authorization']
      exposed_headers: ['X-Auth-Token']
      credentials: true
      max_age: 3600

  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      policy: local

  - name: key-auth
    enabled: false
    config:
      key_names: ["X-API-Key"]
      hide_credentials: true 